from datasets import load_dataset
import os

if __name__ == '__main__':

    raw_datasets = load_dataset(
        os.path.join(os.path.dirname(__file__), "gner_dataset.py"),
        data_dir='../data/',
        instruction_file='../configs/instruction_configs/instruction.json',
        data_config_dir='../configs/dataset_configs/task_adaptation_configs',
        add_dataset_name=False,
        trust_remote_code=True
    )
    print(raw_datasets)

    print(raw_datasets['validation'][0]['instance']['instruction_inputs'])
    #raw_datasets['test'].to_json('../../../../datasets/KIND/test_gner_format.json')
    #raw_datasets['train'].to_json('../data/pileNER-SLIMER-391x100_wD&G_train.json')
    raw_datasets['validation'].to_json('../data/pileNER-SLIMER-391xALL_wD&G_validation.json')

    #data = load_dataset("json", data_files=f'../data/MultinerdIT/test_GNER_format.json')['train']
    #print(data)
    #print(data[0])

    from transformers import AutoTokenizer

    #tokenizer = AutoTokenizer.from_pretrained("meta-llama/Llama-2-7b-chat-hf")
    tokenizer = AutoTokenizer.from_pretrained("meta-llama/Llama-3.1-8B-Instruct")

    #chat_template = tokenizer.get_chat_template()
    #print(chat_template)

    system_message = "You are an expert in Named Entity Recognition."
    row_json = [{"role": "system", "content": system_message},
                {"role": "user", "content": raw_datasets['validation'][0]['instance']['instruction_inputs']},
                {"role": "assistant", "content": raw_datasets['validation'][0]['instance']['prompt_labels']}]
    formatted_input = tokenizer.apply_chat_template(row_json, tokenize=True) #, add_generation_prompt=True)
    print(formatted_input)

    print(tokenizer.decode([128000, 128006, 9125, 128007, 271, 38766, 1303, 33025, 2696, 25, 6790, 220, 2366, 18, 198, 15724, 2696, 25, 220, 1627, 10263, 220, 2366, 19, 271, 2675, 527, 459, 6335, 304, 41559, 10606, 48698, 13, 128009, 128006, 882, 128007, 271, 5618, 24564, 279, 11914, 3984, 11, 25607, 279, 955, 315, 5502, 369, 1855, 3492, 389, 264, 4037, 14656, 35941, 8197, 627, 5207, 3645, 374, 25, 3492, 62, 16, 13648, 62, 16, 705, 3492, 62, 17, 13648, 62, 17, 705, 12515, 1687, 3358, 1005, 279, 73166, 39480, 311, 2440, 279, 15086, 11, 1405, 512, 16, 13, 426, 12, 320, 11382, 8, 15151, 279, 1212, 315, 264, 7086, 5502, 627, 17, 13, 358, 12, 320, 25488, 8, 374, 1511, 369, 4339, 2949, 264, 7086, 5502, 719, 527, 539, 279, 1176, 3492, 627, 18, 13, 507, 320, 42465, 8, 72214, 4339, 430, 527, 539, 961, 315, 264, 7086, 5502, 382, 10464, 279, 3230, 5502, 9681, 25, 2849, 1584, 11, 1404, 11, 734, 11, 6661, 11, 11333, 4009, 323, 507, 627, 85664, 25, 4060, 315, 2324, 2512, 11163, 367, 369, 2911, 662, 1115, 4652, 374, 20034, 311, 3477, 6177, 3495, 389, 842, 482, 315, 482, 2324, 2512, 11163, 367, 320, 469, 1971, 34, 482, 328, 883, 369, 2911, 323, 13878, 14932, 420, 4360, 662, 5075, 838, 768, 315, 469, 1971, 34, 482, 328, 369, 2911, 1253, 13592, 4028, 5961, 389, 2759, 315, 13042, 12062, 1174, 304, 3878, 315, 5110, 1174, 5897, 4819, 323, 51866, 922, 469, 1971, 34, 482, 328, 1174, 902, 3063, 311, 23851, 304, 8893, 6727, 323, 6373, 662, 10541, 2162, 374, 279, 15236, 2035, 315, 4648, 369, 8689, 1174, 3495, 5039, 8952, 5110, 323, 19845, 3642, 311, 387, 279, 1455, 21420, 7634, 1405, 2911, 2815, 662, 2956, 389, 1268, 311, 7124, 19914, 2992, 13803, 323, 2713, 3495, 389, 5623, 6727, 323, 8924, 287, 527, 32161, 662, 22037, 315, 13803, 520, 842, 315, 2324, 320, 469, 1971, 883, 374, 7633, 369, 9572, 6978, 1174, 719, 2478, 9908, 10968, 389, 2536, 263, 66, 5848, 4787, 662, 41525, 3339, 520, 469, 1971, 374, 17037, 14407, 449, 8689, 719, 2911, 527, 2753, 14134, 6532, 662, 362, 17879, 2778, 315, 32906, 574, 13375, 369, 9908, 4756, 304, 279, 1566, 1060, 662, 1226, 1766, 2478, 9908, 23524, 469, 1971, 34, 482, 328, 439, 264, 1566, 22541, 662, 2030, 1268, 1174, 994, 323, 555, 8884, 264, 49648, 374, 4613, 439, 19914, 2992, 1174, 374, 539, 1664, 9749, 662, 4701, 47819, 49648, 6373, 520, 469, 1971, 3235, 449, 11084, 2512, 9293, 13375, 555, 53166, 67597, 54679, 2512, 7411, 1436, 57160, 469, 1971, 34, 482, 328, 662, 4497, 3495, 374, 4460, 662, 128009, 128006, 78191, 128007, 271, 3812, 19792, 8, 315, 19792, 8, 2324, 19792, 8, 2512, 19792, 8, 11163, 367, 19792, 8, 369, 19792, 8, 2911, 19792, 8, 662, 7, 46, 8, 1115, 19792, 8, 4652, 19792, 8, 374, 19792, 8, 20034, 19792, 8, 311, 19792, 8, 3477, 19792, 8, 6177, 19792, 8, 3495, 19792, 8, 389, 19792, 8, 842, 19792, 8, 29506, 46, 8, 315, 19792, 8, 29506, 46, 8, 2324, 19792, 8, 2512, 19792, 8, 11163, 367, 19792, 8, 1819, 46, 8, 469, 1971, 34, 19792, 8, 29506, 46, 8, 328, 19792, 8, 41712, 46, 8, 369, 19792, 8, 2911, 19792, 8, 323, 19792, 8, 13878, 19792, 8, 14932, 19792, 8, 420, 19792, 8, 4360, 19792, 8, 662, 7, 46, 8, 5075, 838, 768, 19792, 8, 315, 19792, 8, 469, 1971, 34, 19792, 8, 29506, 46, 8, 328, 19792, 8, 369, 19792, 8, 2911, 19792, 8, 1253, 19792, 8, 13592, 19792, 8, 4028, 19792, 8, 5961, 19792, 8, 389, 19792, 8, 2759, 19792, 8, 315, 19792, 8, 13042, 19792, 8, 12062, 19792, 8, 81692, 46, 8, 304, 19792, 8, 3878, 19792, 8, 315, 19792, 8, 5110, 19792, 8, 81692, 46, 8, 5897, 19792, 8, 4819, 19792, 8, 323, 19792, 8, 51866, 19792, 8, 922, 19792, 8, 469, 1971, 34, 19792, 8, 29506, 46, 8, 328, 19792, 8, 81692, 46, 8, 902, 19792, 8, 3063, 19792, 8, 311, 19792, 8, 23851, 19792, 8, 304, 19792, 8, 8893, 19792, 8, 6727, 19792, 8, 323, 19792, 8, 6373, 19792, 8, 662, 7, 46, 8, 10541, 19792, 8, 2162, 19792, 8, 374, 19792, 8, 279, 19792, 8, 15236, 19792, 8, 2035, 19792, 8, 315, 19792, 8, 4648, 19792, 8, 369, 19792, 8, 8689, 19792, 8, 81692, 46, 8, 3495, 19792, 8, 5039, 19792, 8, 8952, 19792, 8, 5110, 19792, 8, 323, 19792, 8, 19845, 3642, 19792, 8, 311, 19792, 8, 387, 19792, 8, 279, 19792, 8, 1455, 19792, 8, 21420, 19792, 8, 7634, 19792, 8, 1405, 19792, 8, 2911, 19792, 8, 2815, 19792, 8, 662, 7, 46, 8, 2956, 19792, 8, 389, 19792, 8, 1268, 19792, 8, 311, 19792, 8, 7124, 19792, 8, 19914, 2992, 19792, 8, 13803, 19792, 8, 323, 19792, 8, 2713, 19792, 8, 3495, 19792, 8, 389, 19792, 8, 5623, 19792, 8, 6727, 19792, 8, 323, 19792, 8, 8924, 287, 19792, 8, 527, 19792, 8, 32161, 19792, 8, 662, 7, 46, 8, 22037, 19792, 8, 315, 19792, 8, 13803, 19792, 8, 520, 19792, 8, 842, 19792, 8, 315, 19792, 8, 2324, 19792, 8, 1819, 46, 8, 469, 1971, 19792, 8, 41712, 46, 8, 374, 19792, 8, 7633, 19792, 8, 369, 19792, 8, 9572, 19792, 8, 6978, 19792, 8, 81692, 46, 8, 719, 19792, 8, 2478, 19792, 8, 9908, 19792, 8, 10968, 19792, 8, 389, 19792, 8, 2536, 263, 66, 5848, 19792, 8, 4787, 19792, 8, 662, 7, 46, 8, 41525, 19792, 8, 3339, 19792, 8, 520, 19792, 8, 469, 1971, 19792, 8, 374, 19792, 8, 17037, 19792, 8, 14407, 19792, 8, 449, 19792, 8, 8689, 19792, 8, 719, 19792, 8, 2911, 19792, 8, 527, 19792, 8, 2753, 19792, 8, 14134, 19792, 8, 6532, 19792, 8, 662, 7, 46, 8, 362, 19792, 8, 17879, 19792, 8, 2778, 19792, 8, 315, 19792, 8, 32906, 19792, 8, 574, 19792, 8, 13375, 19792, 8, 369, 19792, 8, 9908, 19792, 8, 4756, 19792, 8, 304, 19792, 8, 279, 19792, 8, 1566, 19792, 8, 1060, 19792, 8, 662, 7, 46, 8, 1226, 19792, 8, 1766, 19792, 8, 2478, 19792, 8, 9908, 19792, 8, 23524, 19792, 8, 469, 1971, 34, 19792, 8, 29506, 46, 8, 328, 19792, 8, 439, 19792, 8, 264, 19792, 8, 1566, 19792, 8, 22541, 19792, 8, 662, 7, 46, 8, 2030, 19792, 8, 1268, 19792, 8, 81692, 46, 8, 994, 19792, 8, 323, 19792, 8, 555, 19792, 8, 8884, 19792, 8, 264, 19792, 8, 49648, 19792, 8, 374, 19792, 8, 4613, 19792, 8, 439, 19792, 8, 19914, 2992, 19792, 8, 81692, 46, 8, 374, 19792, 8, 539, 19792, 8, 1664, 19792, 8, 9749, 19792, 8, 662, 7, 46, 8, 4701, 47819, 19792, 8, 49648, 19792, 8, 6373, 19792, 8, 520, 19792, 8, 469, 1971, 19792, 8, 3235, 19792, 8, 449, 19792, 8, 11084, 19792, 8, 2512, 19792, 8, 9293, 19792, 8, 13375, 19792, 8, 555, 19792, 8, 53166, 19792, 8, 67597, 54679, 19792, 8, 2512, 19792, 8, 7411, 19792, 8, 1436, 19792, 8, 57160, 19792, 8, 469, 1971, 34, 19792, 8, 29506, 46, 8, 328, 19792, 8, 662, 7, 46, 8, 4497, 19792, 8, 3495, 19792, 8, 374, 19792, 8, 4460, 19792, 8, 662, 7, 46, 8, 128009],
                           skip_special_tokens=False))